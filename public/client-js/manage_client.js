$().ready(function () {
    addPreviewImageEvents();
    $('#cover').click(function () {
        $('#imageView').hide();
        $('#cover').hide();
    });
    $('#deleteImage').click(function (e) {
        deleteImage($(this));
        e.stopPropagation();
    });
});

function addPreviewImageEvents() {
    $('.previewInList').click(function () {
        var $view = $('#imageView');
        $view.children('img').attr('src', $(this).attr('src'));
        $view.show();
        $('#cover').show();
    });
}

function addImageUrl() {
    var url = encodeURIComponent($('#image_url').val());
    if (url.trim().length == 0) {
        alert('請輸入圖片網址！'); // FIXME: Change to jQuery UI alert box generated by server with i18n
        return;
    }
    $.ajax({
        method: 'PUT',
        url: '/imageUrl/' + url
    })
        .done(function (html) {
            $('#images').html(html);
            addPreviewImageEvents();
        });
}

function deleteImage($img) {
    alert('確定要刪除圖片？');
    var imgUrl = encodeURIComponent($('#largeView').attr('src'));
    $.ajax({
        method: 'DELETE',
        url: '/imageUrl/' + imgUrl
    }).done(function (html) {
        $('#imageView').hide();
        $('#cover').hide();
        $('#images').html(html);
        addPreviewImageEvents();
    });
}